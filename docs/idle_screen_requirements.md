# 待机页面需求文档

## 1. 功能需求

### 1.1 基本功能
- 显示时钟、日期（公历和农历）
- 显示天气信息（温度、天气状况、湿度、风速）
- 显示空气质量（AQI）和紫外线指数
- 显示未来天气预报
- 支持多个待机页面布局
- 支持页面切换动画

### 1.2 显示内容
- 时钟：支持12/24小时制
- 日期：支持公历和农历显示
- 天气：
  - 当前天气：温度、天气状况、湿度、风速
  - 空气质量：AQI指数和等级
  - 紫外线：指数和等级
  - 未来天气预报：3天预报
- 动画区域：循环播放动画

### 1.3 布局要求
- 支持多个布局方案
- 采用横向布局，适应800*480屏幕
- 使用细线条分隔不同区域
- 时间显示使用大号字体
- 布局美观整洁，具有设计感

## 2. 技术设计

### 2.1 架构设计
```
main/
  ├── display/
  │   ├── screens/
  │   │   ├── idle_screen.h      # 待机页面基类
  │   │   ├── idle_screen.cc     # 待机页面实现
  │   │   ├── idle_layouts/      # 不同布局样式
  │   │   │   ├── layout_base.h
  │   │   │   ├── layout_1.h     # 布局1：时钟+日期+天气
  │   │   │   └── layout_2.h     # 布局2：其他组合
  │   │   └── components/        # 可复用组件
  │   │       ├── clock_widget.h
  │   │       ├── calendar_widget.h
  │   │       ├── weather_widget.h
  │   │       └── animation_widget.h
  │   └── lcd_display.h
  └── settings/
      └── idle_settings.h
```

### 2.2 布局设计

#### 布局1（优化版）：
```
+------------------------------------------------------------------+
|                                                                  |
|   +----------------+  +----------------+  +----------------+     |
|   |                |  |                |  |                |     |
|   |   上海 25°C    |  |     12:30      |  |    AQI:75 良   |     |
|   |     晴         |  |  2024-03-20    |  |    UV:6 中等   |     |
|   |   湿度: 65%    |  | 农历二月十一   |  |                |     |
|   |   风速:3.5m/s  |  |                |  |                |     |
|   |                |  |                |  |                |     |
|   +----------------+  +----------------+  +----------------+     |
|                                                                  |
|   +----------------------------------------------------------+  |
|   |                                                          |  |
|   |                    未来天气预报                          |  |
|   |  3/21 多云 26°/18° | 3/22 雨 24°/17° | 3/23 晴 25°/19°  |  |
|   |                                                          |  |
|   +----------------------------------------------------------+  |
|                                                                  |
+------------------------------------------------------------------+
```

#### 布局2（简约风格）：
```
+------------------------------------------------------------------+
|                                                                  |
|   +----------------------------------------------------------+  |
|   |                                                          |  |
|   |                       12:30                             |  |
|   |                    2024-03-20                           |  |
|   |                    农历二月十一                          |  |
|   |                                                          |  |
|   +----------------------------------------------------------+  |
|                                                                  |
|   +----------------+  +----------------+  +----------------+     |
|   |                |  |                |  |                |     |
|   |   上海 25°C    |  |    [动画区域]  |  |    AQI:75 良   |     |
|   |     晴         |  |                |  |    UV:6 中等   |     |
|   |   湿度: 65%    |  |                |  |                |     |
|   |   风速:3.5m/s  |  |                |  |                |     |
|   |                |  |                |  |                |     |
|   +----------------+  +----------------+  +----------------+     |
|                                                                  |
|   +----------------------------------------------------------+  |
|   |                                                          |  |
|   |  3/21 多云 26°/18° | 3/22 雨 24°/17° | 3/23 晴 25°/19°  |  |
|   |                                                          |  |
|   +----------------------------------------------------------+  |
|                                                                  |
+------------------------------------------------------------------+
```

### 2.3 配置项
```json
{
  "idle_screen": {
    "current_layout": 0,
    "language": "zh_CN",
    "time": {
      "format": "24h",
      "timezone": "Asia/Shanghai",
      "date_format": "YYYY-MM-DD",
      "show_lunar": true
    },
    "weather": {
      "city": "Shanghai",
      "update_interval": 3600,
      "units": "metric",
      "show_air_quality": true,
      "show_uv_index": true
    },
    "layout": {
      "margin": 20,
      "padding": 15,
      "widget_spacing": 20,
      "widget_width": 240,
      "widget_height": 200,
      "forecast_height": 120,
      "border_width": 1,
      "border_color": "#CCCCCC"
    },
    "animation": {
      "frame_interval": 1000,  // 动画帧间隔1秒
      "frames": [
        "frame1.png",
        "frame2.png",
        "frame3.png"
      ]
    }
  }
}
```

### 2.4 天气API接口
```json
// 请求格式
GET /api/weather
参数：
- city: string (城市名称或ID)
- lang: string (语言代码)
- units: string (温度单位：metric/imperial)

// 响应格式
{
  "current": {
    "temperature": 25.5,
    "condition": "晴",
    "icon": "sunny",
    "humidity": 65,
    "wind_speed": 3.5,
    "air_quality": {
      "aqi": 75,
      "level": "良",
      "pm2_5": 35,
      "pm10": 45
    },
    "uv_index": {
      "value": 6,
      "level": "中等",
      "protection": "建议涂抹防晒霜"
    }
  },
  "forecast": [
    {
      "date": "2024-03-20",
      "lunar_date": "二月十一",
      "temperature": {
        "max": 26,
        "min": 18
      },
      "condition": "多云",
      "icon": "cloudy",
      "air_quality": {
        "aqi": 80,
        "level": "良"
      }
    }
  ]
}
```

## 3. 实现注意事项

### 3.1 显示要求
- 时间使用大号字体
- 使用细线条分隔不同区域
- 动画区域不添加边框
- 保持界面整洁美观

### 3.2 性能要求
- 动画切换间隔1秒
- 天气数据更新间隔1小时
- 页面切换使用滚动动画

### 3.3 扩展性
- 支持添加新的布局
- 支持添加新的显示组件
- 支持配置项的自定义

## 4. 后续优化方向
1. 支持自定义背景图片
2. 支持多种动画主题
3. 添加更多天气信息显示
4. 优化动画切换效果
5. 添加更多布局选项 